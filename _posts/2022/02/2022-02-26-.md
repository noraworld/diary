---
layout: post
title: "2022-02-26"
# date: "2022-02-27 02:05:03 +0900"
---

# Mermaid 書いてみた
今日は cherry-pick 廃止作業をまとめる技術記事に Mermaid でブランチ構成図を書いたり作業フロー図を書いたりしていた。

つい最近 GitHub が Mermaid をサポートしたこともあって、どんなものか使ってみたかったというのもある。

ちなみに GitHub がサポートするまで Mermaid という便利なツールがあること自体知らなかった。最初は、GitHub がつい最近 Mermaid という便利なツールを発表したのかと勘違いしてしまったが、Mermaid 自体は GitHub 社とは別で数年前から開発されていたようだ。

あまり複雑な構成図を書こうとするとぐちゃぐちゃになっちゃったり、書き方にテクニックがあったりするが、慣れれば便利そうだなと思った。

Mermaid 関連でさっそく記事を書いた。

https://zenn.dev/noraworld/articles/mermaid-duplicate-objects











# AWS Lightsail の Nginx がなぜか落ちていた件
数日前から GitHub to Qiita が失敗していることに気づいた。

それだけではなく旧日記サイトや Mastodon なんかもつながらないことに気づいた。

AWS Lightsail のコンソールにはしばらく入ってなかったので、なんでだろうと思い久々にコンソールに入った。

しかし特に変なところは見当たらず。

とりあえず再起動してみたが、特に変化せず。

ping しても応答がないのでネットワークがなんかおかしいのかなと思ったが、後々調べてみるとこれは AWS Lightsail の仕様っぽい。紛らわしい。

https://serverfault.com/questions/1003966/how-do-i-allow-icmp-to-lightsail-instance#answer-1003969

その後、旧日記サイトを対象として curl してみると、HTTP アクセスはできるけど HTTPS アクセスができないことが判明。

そしてブラウザで HTTP アクセスしてみると、なんと Nginx のウェルカムページが表示された。

ここまできて Nginx に問題があることがわかった。

`systemctl status nginx` とするとデーモンが立ち上がっていることがわかったのだが、何かおかしい。

Lightsail で使っている Nginx はレスポンスヘッダを隠蔽するためのモジュールを組み込むために自前でビルドしたものを使っている。

そしてそれはデーモンに登録していないので、デーモンとして立ち上がっているのはおかしいのだ。

つまり、なんらかの拍子でパッケージ版の Nginx がインストールされてしまい、そちらが起動してしまったのだと推測。

いったんデーモンのほうの Nginx は止めて、自前ビルドした Nginx のコマンド経由で起動したところ、無事、想定通りとなった。

あと GitHub to Qiita のプロセスが起動していなかったので起動した。これで元通りとなった。

しかし気がかりなのは、なぜ突然このようなことになってしまったかだ。別に AWS の設定を何かいじったわけでもないのに。

GitHub to Qiita の Webhook の応答が失敗し始めた 23 日はちょうど SSL 証明書の自動更新のタイミングで Nginx がリロードされたので、それが関係あるのかもしれない。

と思ったけど、自動更新の実行時刻と失敗し始めたタイミングが微妙に噛み合わない。自動更新したあと、しばらくは問題なかったようにも見える。

だいいち、Nginx のリロードが原因だったにしても、急にパッケージ版の Nginx がインストールされてそちら側が起動してしまうのもおかしい。

AWS 側で何かが行われたのかもしれないけど、そういうメールも特に来ていなかったはずだし、やっぱりなんかおかしい。

よくわからないことだらけだけど、とりあえず直ったのでヨシとする。

というか、そろそろサーバ関連も整理していきたい。旧日記システムのデータを移行して、Mastodon をなんとかして、GitHub to Qiita も GitHub Actions などに移行すれば、もうサーバも必要ない気がする。というか管理コストもあるし、そうしたい。

ぼちぼちやっていったほうが良いかなあ。







# 技術記事ブログの Jekyll のビルドが失敗しているのを修正
だいぶ前から技術記事ブログの Jekyll のビルドが失敗していた。けどあまり活用してないから放置していた。

でも昨日あたりにローカルで `jekyll serve` を実行したらエラーで立ち上がらなかったので、そろそろ直すかということで今日直した。

原因は、Jekyll で使えるプラグインをまとめた記事で、Liquid の説明内で Liquid のテンプレート用のタグが解釈されてしまいエラーになっていたようだ。

まさか各記事のマークダウンにまで Liquid のテンプレートが展開されるとは思わなかった。

そしていつも Zenn エディタのプレビュー機能を使っているから気付くのが遅れた。

修正したらエラーが直った。でめたしおひたし。





# サイト説明文変更
日記のサイト説明文を以下のように変えた。

『昔人もすなる日記といふものを、我もしてみむとてするなり。』

紀貫之の有名な日記の冒頭をオマージュしたものだ。

べつに変更したことに大きな意図はなく、なんとなく変えてみたかったから変えただけ。

今日思いついたわけではなく、昔からこの説明文に変えてみようとは思っていたが、なんやかんやで放置していたのを、今日思い立ってやった。

とはいえブログのデザインを変えてからサイト説明文が表に出なくなっちゃったんだけどね。






# リングフィットアドベンチャー
第 273 回目。

<iframe width="560" height="315" src="https://www.youtube.com/embed/J64htn0dy4Y" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

腕のスキル縛りのミッションがあって久しぶりに腕のスキルを使った。結構きつかった。

あと今日は単純に長くやりすぎて後半つかれた。










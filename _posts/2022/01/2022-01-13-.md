---
layout: post
title: "2022-01-13"
# date: 2022-01-13 17:54:26 +0900
private: false
---

# Codecov の導入が全然うまくいかずイライラ
昨日、夜遅くまでやっていたカバレッジのバッジを README に表示する対応、結局、昨日の段階では解決せず終わった。

で、今日、もう一度よく調べてみたら、Codecov で設定されているブランチが違うとデータが正しく表示されないということに気づいた。

設定では `develop` を向いているのに対し、今回導入のために試行錯誤していたのはもちろん別ブランチなので、それがうまく動いていない原因だった。

気づいてしまえばなんてことはないミスではあったのだが、ふつう導入するときは別ブランチを切るし、デフォルトブランチじゃないから表示がうまくいっていないなんて教えてくれるわけでもないから結構罠だなと思った。

というわけで、ブランチを一時的に変えることによって動くことが確認できたのは良かったのだが、別の問題が生じた。

Codecov が過去にスクリプトを改ざんされていたらしく、セキュリティ的に問題があることをチームメンバーが指摘した。

CircleCI の Codecov 用の orb を使っていたのだが、この orb、バグが多すぎて、バージョン 1.0.5 でしか正常に動作することを確認できなかった。

しかし、セキュリティの問題を解決するには、少なくとも 1.1.4 まで上げなければいけないことが判明。でも、1.1.4, 1.1.5, 1.1.6, 1.2.5 などは全部シンタックスエラーで動かなかったし、2.0.0 以降は `gpg not found` というエラーでダメだった。

というわけで、せっかく正しく機能したと思いきや、導入するにはこの問題を解決しなければならず、また問題が増えて正直うんざりしている。README にバッジ追加するだけだからそんなに難しくないとは思ったのに、細々とめんどくさいことが立て続けに起こってイライラする。

他にもやらなきゃならないことがあってこればっかりに時間を費やすこともできないから、中途半端なままになりそうでそれもまたモヤモヤする。

仕事でこんなイライラするのは久しぶりかもしれない。うまく動作しない理由がなかなか解決できないときもイライラするけど、セキュリティなどの観点で思い通りに導入できないのもイライラすることがわかった。

ていうかそもそも Codecov の orb のスクリプトがバグ多すぎるんだよなあ。ちゃんとメンテナンスされてるのか？ というか、Docker なら Alpine を使うこともあるだろうに、Bash でしかちゃんと動かないスクリプトしか提供していないってなんなのほんと。

本当にイライラする......。

## 追記
これ書いたあともひたすらネットで情報調べて、なんとか CircleCI の orb を使わない方法で CI を通して動作させることができた。もちろんセキュリティの面も対策した。

まだ憤りの気持ちは残っているものの、ひとまず目的は遂行できてよかった。





# Oculus Quest 2 が届いた
16 時台に Oculus Quest 2 が届いた。注文時にはお届け予定日が 19 日と書かれていたので、予定よりもだいぶ早く到着した。これは嬉しい。

さっき書いた仕事の件の他にやらないのといけないことがあって、今日はセットアップできるかわからないけど、また VR を楽しむことができてちょっと楽しみだ。

買い直すくらいだったら最初から手放さなければよかったな、、、ってこれ、注文したときの日記でも書いたっけ。しばらく使ってなかったからそのときは要らないかなと思っちゃったんだよな。





# お腹の調子が悪い
今日はなんかわからないけどお腹の調子があまり良くなかった。ちょうど昨日買ったどら焼きを食べたあとくらいからだけど、その前もそんなによくはなかった。

久々に腹痛かも。






# カーテン届かなかった
Oculus Quest 2 は予定よりも早く届いたが、カーテンは届かなかった。メールでは今日到着すると書いてあったのだが。

まあそのうち届くだろう。





# 最寄りのセブンイレブンの品揃え
今日も仕事が遅くなり 23 時ごろに最寄りのセブンイレブンに行ったのだが、弁当系のコーナーに何もないくらい品揃えが悪かった。

やはり 24 時で閉店するから、あまり在庫を抱えないようにしているんだろうか。

今日はなんとか 24 時前には間に合ったがこれでは意味がない。あのセブンイレブンはもうちょっと早く行かないと品揃えが悪すぎる。

遅い時間帯になってしまったら、最寄りのセブンイレブンじゃなくて、駅前のほうに行ったほうが良いかもな。










---
layout: post
title: "2022-10-10"
---

* ここ数日は日記を書く間も惜しんでひたすらネットワークの改造をしていた
    * USB-LAN アダプタが届いてからずっとネットワーク 2 分割作戦を構築していて、数日かかってようやく形になった
    * USB-LAN アダプタは 2 つ買って、最初に買ったほうは Amazon で返却した
        * ドライバがないと Linux では動かないと書かれていたがそのドライバがインストールできない
        * まずドライバは付属の CD でインストールできると書かれていたのにその CD が付属していない
        * ネットでドライバは見つかったのだが、`make` を実行するとエラーになる
        * Linux Kernel のシステム要件は満たしているはずなので何かがおかしい
        * ということでドライバは諦めた
        * というかドライバをインストールしないといけない時点で買うべきではなかった
        * 単純にめんどくさいというのもあるし、たかが USB-LAN ごときでファイル環境が汚れるのも嫌だし、何より今後新しく構築し直すことになったときの再現性がめんどくさい
        * 挿すだけでは動作しないと思っていたのだが、のちのち単純に netplan の設定が足りていないだけだということに気づきふつうに使えた
        * だがなんか Mac の音が乱れるという謎現象もあり、すでに返却のリクエストは送ってしまっていたのでそのまま返却することに
    * 新しいほうはドライバが必要ないことは前もってわかっていたので挿すだけで使えた
        * まあ前のほうもそうだったんだけど
    * iptables で DNS と同じように一つ一つドメインをブロックするルールを入れていると、CPU 使用率がものすごく高くなることが判明
        * そのせいで PulseAudio の音声が乱れる & 通信速度が著しく低下することが判明
    * どうしようかと思っていたが、寝て起きたら素晴らしい解決策を思いついた
    * 53 ポートをブロックするだけで良かった
    * これでパブリック DNS へのパケットがドロップされ Raspberry Pi の DNS を使わざるを得ない状態になった
    * わざわざ iptables でドメインを一つずつブロックしなくても、DNS の設定を使わざるを得ないようにすれば良いと気づいたわけ
    * 天才
    * その後は今までのドメインでの制御を全部外し、53 ポート拒否の設定を外したり逆に許可する設定で上書きしたりしたことを検知するともとに戻すスクリプトを作って cron で定期実行させるようにした
    * これでかなり完璧になった
    * あと IPv6 とかも対応できるようになるのかなとか思ったりしているけど今のところうまく動いているし IPv6 なくても今のところ困らないのでやるかどうかは未定
    * 近々、この内容をまとめた技術記事を書こう
* メモ: リモコンキーボードに必要なキー
    * 部分リピート
    * 速度アップ
    * 速度ダウン
    * 速度リセット
    * 上下左右
    * エンター or スペース
    * 動画要素の移動

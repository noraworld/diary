---
layout: post
title: "2022-10-02"
# date: "2022-10-03 07:26:37 +0900"
---

# 出来事・やったこと
* 今日は一日中ずっと iptables のネットワーク制限を実運用するためのスクリプトを書いたりディレクトリ構築をしたりしていた
    * 途中いろいろとうまくいかなくてフラストレーションが溜まることがあったけど、なんとか実運用できそうなところまで進めることができた
    * Dnsmasq だけだと Mac ではもう制限を外すことに慣れちゃったりしていて、そのせいで数日前もひたすら YouTube 見まくったりしてしまったので、とにかく早く対応したかった
    * cron にも組み込むことができたのでとりあえずは実運用できる状態になった
    * 今のところまだ対応できていないのは、英語の勉強時間に特定のサイト以外すべてブロックする設定
        * なんかふつうに全部制限かけちゃうと、そのあとで特定のサイトを許可しても許可されない
        * これがなんでなのか解決できなかったのでとりあえず保留
    * あとはファイル監視システムを iptables-conf にも導入して簡単に設定を変えられないようにしたり、スクリプトのリファクタリングをしたりとかかな
    * 一部のサイトで YouTube とか Netflix のリソースを使っていると表示されるまでにしばらく時間がかかったりそもそもページを表示できなかったりしたんだけど、Dnsmasq の制限もかけると解消されることがわかった
        * https://jp-news.mercari.com/articles/2019/07/19/item-rule-pse-symbol/
            * どうやら [YouTube Player API](https://www.youtube.com/iframe_api) を使っているらしく、これの読み込みがタイムアウトするまでページ全体が全く表示されない
            * 読み込みがタイムアウトするまで 1 分くらいかかるからかなり遅い
            * Dnsmasq の制限もかけておくと速攻で YouTube API の読み込みエラーになるのでページがすぐに表示される
        * https://www.arrowslabo.net/archives/8515
            * Twitter のウィジェットを読み込もうとしてページの読み込みが完全に完了するのに数十秒かかる
            * Dnsmasq の制限もかけておくと速攻で Twitter ウィジェットの読み込みエラーになるのでページがすぐに表示される
        * https://languagelearningwithnetflix.com
            * Dnsmasq の制限をかけておかないと (iptables の制限だけだと) ページ全体にアクセスできない
            * たぶん `netflix.com` っていう文字列がドメインの中に含まれているからだと思う
        * https://kreeblog.com/english-tool-lln/
            * 記事内に YouTube 動画が埋め込まれていて、これの読み込みタイムアウトになるまでずっとページのロードが発生する
            * Dnsmasq と併用すると名前解決できなくて速攻でエラーになるのでページの読み込みがすぐに完了する
        * iptables の REJECT に該当したときにタイムアウトになるまで数十秒から 1 分程度待たないといけないの、なんかイケてないけど、これは Dnsmasq の制限を外しているペナルティとして解釈するとなんかむしろ良いかも
            * 調べてみたけど TCP/IP 層ですぐにエラーにさせる方法はよくわからなかった
            * DNS レベルだったら速攻でエラーにしてくれるからやっぱり併用するっていうのが大事なのかもしれないな
            * いや、そもそも TCP/IP レベルでのブロックは DNS レベルでの制限を解除するのが簡単にできてしまう対策なので、DNS レベルのブロックを解除するな！ っていう警告って感じとして解釈しよう
    * OUTPUT の制限をかけてしまうと Raspberry Pi 自身がそのサイトへのパケットのやり取りができなくて Dnsmasq もエラーになってしまって何も制限がかからない状態になってしまったので外した
        * Dnsmasq の制限が常に入っている iPhone でもすぐにタイムアウトにならずにずっとロードされていたりたまにアクセスできてしまったりするの、おかしいなと思っていたけどそういうことだったのか
* 昨日 Amazon で質問していた Anker のドッキングステーションのコイル鳴きについて回答が 5 〜 6 件くらい来た
    * ほとんど音はしないという回答だった
    * どうやらこれは個体差らしい
    * 当たりを引ければ良いけどハズレだったら交換してもらえるかな
    * まあ商品特有の問題じゃないなら買うのもありかな



# 思ったこと・気づき・学び
* 片耳だけ耳栓して Cambly のレッスンを受けたんだけど、やっぱり聞きづらいからちゃんと両耳で聞くべきだなと思った
    * ただでさえ英語を聞くのは集中しないといけないのに、耳栓で片方聞こえないと結構理解しづらくなってしまう
    * Cambly のレッスンは貴重な時間だからあまりこういうところで機会損失をしないように心がけたい



# 睡眠記録

| 項目 | 内容 |
| --- | :---: |
| 寝たの |
| 起きたの |
| スコア |

## 感想
*



# 夢日記
*



# 瞑想記録

| 項目 | 内容 |
| --- | :---: |
| 時間 (分) |
| 集中できたか |
| その後のパフォーマンスは上がったか |

## 感想
*



# 運動記録
*

## 感想
*



# Atsueigo School
## 今日やったこと
*

## 明日やること
*

## 学習時間
*

## 感想
*



# えらい！
*



# 気分レベル (10 段階)




# 今日の気分はどうだったか
* 喜怒哀楽



# アンガーログ
*



# 他人に与えた好影響
*



# 感謝日記
*



# 一日一善
*



# 今日の挑戦
*



# 明日やること
*



# 筆記開示
*

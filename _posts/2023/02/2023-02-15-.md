# Guidable の人と面談
昨日、カジュアル面談の予定を入れ、さっそく今日の 18:00 から面談をした。30 分の予定だったが 1 時間ちょっと話をした。

Zoom でやったのだが無料枠で 1 セッションが 40 分弱しかなかったので一度退出してもう一度入り直すことで延長した。有料枠を会社で用意していないことからするとあまり制度が充実している感じではないのかなと思ってしまった。

今回カジュアル面談を受けることになった理由としてはメールに英語を活かせる的なことが書かれていたからなのだが、話を聞いているとそこまで英語が話せる機会があるわけではないということがわかった。エンジニアが 5 人いて、そのうちの 1 人がアメリカ人で日本語はしゃべれないとのこと。なので今日面談した人 (日本人) が英語でコミュニケーションを取っているのだそう。残りの 3 人は英語をしゃべることができないので基本的にアメリカ人のエンジニアと会話をするのは今日面談した人だけらしい。

そんな感じなので、たぶん入社しても英語でミーティングしたりとかはできなさそうな気がする。

また、海外からフルリモートで仕事をすることができるかと質問したのだが、それは今のところできないとのこと。理由は時差があって夜だと実力を発揮できないからだという。じゃあオーストラリアのように日本との時差があまりないところだったらどうなのかと聞いたが、やはり今のルールだと海外からはできないとのこと。ただし今後ルールもアップデートするかもしれないと言っていた。

とはいえ、今のところ英語を積極的に話せる環境でもなければ海外から働くこともできないのでこの会社に転職する価値はあまりなさそうだ。ちなみに海外からフルリモートで働けるかどうかを聞いたのは、ワーキングホリデーで海外に行ったあとにそのまま観光ビザなどで滞在できるようにしたいからだ。前にも書いたとおり就労ビザを獲得するのは難易度が高そうなので。



# diary-system の環境構築
旧日記サイトの日記データを GitHub リポジトリ側に移動させたいと思い早数年が経った気がする。いい加減これを実現したいなあと思い、今日ようやく diary-system の環境構築を Mac で行った。だいぶ放置していて古いプロジェクトになっている上に Mac のほうはかなり新しいものなので環境構築に結構苦戦した。具体的な解決方法などに関しては[スクラップ #47](https://github.com/noraworld/scraps/issues/47) にメモした。

無事起動したあといろいろと動作確認していたらいろいろとバグっていて動作しないところがあったので修正した。昔はあれだけ積極的に使っていたのに未だにこんなバグがあったんだなあと驚いている。

* [dependabot の修正分をすべてもとに戻す](https://github.com/noraworld/diary-system/commit/2c6c25175e1949d9a778319ac9ed552cbd51f5be)
    * なんの動作確認もしないまま dependabot の PR をマージしていて、いざ今日環境構築したときに思うように動かなかったので
    * バージョンを上げても良かったのだが、エクスポート機能を実装させたらもうこのシステムも使わなくなるだろうし、ライブラリのバージョンを上げるには Ruby のバージョンを上げる必要があって影響範囲が大きくなりそうだなと思ったのでなるべく既存のバージョンでなんとかやるようにした
* [ライブラリのバージョンを上げる](https://github.com/noraworld/diary-system/commit/43884722bcd5288b3ac8ac77a922df0748e07e11)
    * とはいえうまくインストールできなかったライブラリに関してはアップデートした
    * therubyracer は会社のプロジェクトで環境構築をしたときにどうしてもうまくインストールできない上に必要ないということがわかったので今回も同様にアンインストールした
* [`/vendor/bundle` を無視](https://github.com/noraworld/diary-system/commit/5b186a4a7ef81b1fbfe8b10c6c9cf1692c07b844)
    * 最近になって `bundle install` はグローバルじゃなくてローカルにインストールするようにしたのだが `/vendor/bundle` が `.gitignore` に入っていなかったので入れた
* [`undefined method next_day_adjustment_hour` を修正](https://github.com/noraworld/diary-system/commit/e85095453370aebf1d8b3d838bbdfc7f7ef215f8)
    * これを実装したときの環境ではすでに `settings` レコードが用意されていたから問題なかったが、今回新しく環境構築をしたときにこのレコードがなくてエラーになっていた
    * レコードがない状態でもエラーにならないようにした
* [パラメータが不足していたとき専用のエラー JSON を返すように](https://github.com/noraworld/diary-system/commit/3865dd479f78a13885fbd0e8d23c025d51e4ca13)
    * デバッグしていたときにパラメータがなくて例外が発生してしまうとなんか微妙だなと思ったので
* [パスが間違っていて画像が保存できない問題を修正](https://github.com/noraworld/diary-system/commit/96fd84e986a6d7cf157b1bc2a546fd6b75b2142e)
    * 画像保存先パスのディレクトリ名の部分が `02` のようにならないといけなかったのに `2` になってしまっていたので修正した
    * ていうかこれ今まで何の問題も発生していなかったのが不思議

早くエクスポート機能を実装して現日記システムと統合したい。



# リンクを新しいタブで開くようにした
Raspberry Pi で稼働している日記だが、リンクを新しいタブで開いてくれない。もともとマークダウンはリンクを新しいタブで開くように設計されていないのだが、旧日記サイトではマークダウンパーサに Qiita::Markdown を使っていて、これに外部リンクは新しいタブで開くオプションがついていた。

しかし Jekyll でデフォルトで使用されるマークダウンは外部リンクを新しいタブでは開いてくれないので、外部リンクに `target="_blank"` を付与する JavaScript を書いてデプロイした。Jekyll でもマークダウンパーサを自分で選ぶことはできるのだが、GitHub Pages に載せたときに動かないので、ここらへんの互換性をなるべく維持しようと思ってデフォルトのパーサを使っている。だから JavaScript で無理やり `target="_blank"` をつけるくらいしかやり方がなさそうだ。

なお、日記内に飛ぶリンクやページ内リンクに関してはもちろん現在のタブで開くようになっている。ここらへんの仕様は Qiita::Markdown と同じにそろえてある。

## テスト用リンク
* [これは現在のタブで開く (昨日の日記へ)](/2023/02/14)
* [これは新しいタブで開く (Google)](https://www.google.com)
* [これはページ内リンク](#diary-system-の環境構築)

## URL をリンク化したい
あと Jekyll のデフォルトパーサにはもう一つ不満があって、URL をリンク化してくれないのだ。たとえば https://www.google.com と書いてもそれをリンクにしてくれない。これも JavaScript でゴリゴリやるコードを書きたい。



# プライベート日記にもタイムラインを追加した
[タイムライン](/timeline)をプライベート日記リポジトリのほうにも追加した。最近のプライベート日記を見ているとあとから振り返りたい内容があると感じたので。ただしまだサイト上には表示されない。

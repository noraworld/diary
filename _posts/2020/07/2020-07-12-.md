今日は夜中に起きた。そのあと YouTube 見たりしていたけど、買い物に行きたくなったので明け方に外に出た。

せっかく外に出たので、散歩することにした。YouTube Music で好きな音楽を聴きながら (this is a private diary) 散歩した。明け方でも人がいてうんざりしたが、散歩自体は気分が良かった。

散歩の帰りにドラッグストアに寄って適当に食料品を買った。前に買ったフルグラがまだ残っているが牛乳が残りわずかだったので牛乳を買った。フルグラはしばらくやめておこう。あまり腸に良くない（ぎゅるぎゅるすることがある）し、砂糖も入っているので。

帰宅後は、散歩で気分が良かったので、HIIT バーピーをした。今日は 6 セットやった。4 セットでも結構キツイと感じていたのに、6 セットもやったらかなり汗だくになってしまった。心拍数も 180 オーバーだった。

昔は 8 セット、場合によっては 10 セット以上を週に 3 回とかやっていたから我ながらすごいなと思う。どこにそんな体力と気力があったんだろうか。今は 6 セットでもゼーゼーするというのに......。

バーピーをしたあとは開発をした。今日は機能開発というよりメンテナンス性向上目的だった。

実装したものとしては、

- 翌日調整時間とタイムゾーンを設定ページに追加
- ハードコーディングされていた部分で、それらの値を使用するようにした

この日記は、翌日の 5 時までは、前日の分として扱われるようになっている。日をまたぐ前に寝ることなんて稀で、深夜の 2 時とかに更新することもあるからだ。

ただ、その 5 時という値をハードコーディングしてしまっていた。特に困ることはなかったが、メンテナンス性は良くないなと前々から思っていた。それを設定から変更できるようにした。

決め打ちで `5` という値にするのではなく、設定でこの値を変更できるようにした。でも、あとから気づいたが、そうすると日記を更新できなかったとき（5 時を過ぎてしまったとき）に設定で一時的に数値を変更して更新...... ということができてしまうので、設定ページから気軽に変更できるようにするのはやめたほうが良いかなと思った。

あとはタイムゾーンも変更できるようにした。今までは `Tokyo` でハードコーディングされていて、オープンソースとしては扱いづらいものとなってしまっていたのでこれも設定で変更できるようにした。

ただ、これもあとから気づいたのだが、`config/application.rb` の `conig.time_zone` で設定する値には使えないという問題がある。`config/application.rb` を読み込むタイミングでは DB の値にアクセスすることがまだできないのだ。

となると、`conig.time_zone` を各自の環境に合わせて変更できるようにするためには、環境変数を使うことになる。そうなると、DB に保存されているタイムゾーンと、環境変数で設定したタイムゾーンで、二重管理になってしまう。二つの値を別々にする必要性は、当然ない。ということはつまり無駄に設定を増やしてしまっただけになる。

てな感じで、翌日調整時間もタイムゾーンも、設定ページから変更できるような値として追加する必要があったのか？ と実装してから感じてしまった。まあ開発しているときは気づかないこともあるよね。

昼過ぎくらいまでそれを実装していて、急激に頭が働かなくなって眠くなったので寝た。そして夜の 10 時くらいに目が覚めて、今、深夜 1 時半くらいにこの日記を書いている。

---

[Block Yourself from Analytics](https://chrome.google.com/webstore/detail/block-yourself-from-analy/fadgflmigmogfionelcpalhohefbnehm) というものを導入した。特定のウェブサイトのみ Google Analytics をオプトアウトするという拡張機能だ。シークレットモードでも有効にしている。

[Google Analytics オプトアウト アドオン (by Google)](https://chrome.google.com/webstore/detail/google-analytics-opt-out/fllaojicojecljbmefodhfapmkghcbnh) も使っているが、こっちは Google アカウントに紐付いている場合にしか有効にならない。つまりシークレットモードを起動している間は Google アカウントにログインしていない状態なので、この拡張機能ではオプトアウトされない。

プライベートタグを使ったりしたときにちゃんとプライベート化されているか不安だったりするので、シークレットモードで確認することがよくある。そういうときにシークレットモードでのアクセスが毎回 Google Analytics でカウントされてしまうのが嫌だったので、シークレットモードでもオプトアウトされるように別の拡張機能を導入したというわけだ。

iPhone でアクセスする際にも Safari の拡張機能で Google Analytics をオプトアウトしているので、自分がアクセスする分はすべてオプトアウトされたはずだ。これで純粋なデータを取ることができる。

ところで、シークレットモードだとやっぱり同一アクセスとしてみなされないんだな。シークレットモードで日記を開いて、閉じてまたシークレットモードで開いて、というのを繰り返すとアクティブユーザがどんどん増えていくことがわかった。同一ユーザとして認識されるのは、同じ Google アカウントに紐付いている必要があるということなのかもしれない。あるいは同じクッキーを持っているかとか。

まあ逆に言えばシークレットモードがちゃんとシークレットしていたということでもあるな。



# 食べたもの
- プロセスチーズ
- フルグラ
- プロテイン



# 今日の学び
- やっぱり HIIT バーピーするとやる気が出る



# 成長記録
散歩 40 分くらいできたし、HIIT バーピーもやったし開発もした。非常に充実した一日だった。



# 気分レベル
8



# 今日の気分はどうだったか
気分は良かった。散歩と HIIT バーピーが効いているんだと思う。やっぱ運動だいじだね。
